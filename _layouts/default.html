<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ page.title }} - {{ site.title }}</title>
    <meta
      name="description"
      content="{{ page.description | default: site.description }}"
    />

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{{ page.title }}" />
    <meta
      property="og:description"
      content="{{ page.description | default: site.description }}"
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ site.url }}{{ page.url }}" />
    <meta
      property="og:image"
      content="{{ site.url }}/assets/images/og-image.jpg"
    />
    <meta property="og:site_name" content="{{ site.title }}" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{ page.title }}" />
    <meta
      name="twitter:description"
      content="{{ page.description | default: site.description }}"
    />
    <meta
      name="twitter:image"
      content="{{ site.url }}/assets/images/twitter-card.jpg"
    />

    <!-- Additional SEO Meta Tags -->
    <meta name="author" content="Abdul Aziz Zailani" />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="#667eea" />
    <link rel="canonical" href="{{ site.url }}{{ page.url }}" />

    <!-- Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-XXXXXXXXXX");
    </script>

    <!-- A/B Testing Configuration -->
    <script>
      // Simple A/B Testing
      const abTestVariant =
        localStorage.getItem("abTestVariant") ||
        (Math.random() < 0.5 ? "A" : "B");
      localStorage.setItem("abTestVariant", abTestVariant);
      document.documentElement.setAttribute("data-variant", abTestVariant);

      // Track page views
      if (typeof gtag !== "undefined") {
        gtag("event", "page_view", {
          variant: abTestVariant,
          page_title: "{{ page.title }}",
        });
      }
    </script>

    <link
      rel="stylesheet"
      href="{{ '/assets/css/style.css' | relative_url }}"
    />
    <link
      rel="stylesheet"
      href="{{ '/assets/css/floating-terminals.css' | relative_url }}"
    />
    <script
      src="{{ '/assets/js/structured-data.js' | relative_url }}"
      defer
    ></script>
    <script
      src="{{ '/assets/js/terminal-grid.js' | relative_url }}"
      defer
    ></script>
    <script
      src="{{ '/assets/js/floating-terminals-complete.js' | relative_url }}"
      defer
    ></script>
    <!-- Import Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <!-- Download Resume Button -->
    <style>
      @media screen {
        .print-btn {
          position: fixed;
          bottom: 20px;
          right: 20px;
          background: rgba(57, 255, 20, 0.9);
          border: 2px solid #39ff14;
          color: #0a0e27;
          padding: 12px 20px;
          border-radius: 6px;
          cursor: pointer;
          font-family: "JetBrains Mono", monospace;
          font-weight: 600;
          font-size: 0.9em;
          z-index: 9999;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px rgba(57, 255, 20, 0.3);
          text-decoration: none;
          display: inline-flex;
          align-items: center;
          gap: 8px;
          animation: pulse-border 2s infinite;
        }

        .print-btn:hover {
          background: #39ff14;
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(57, 255, 20, 0.5);
        }

        .print-btn i {
          margin-right: 0;
        }
      }

      @media print {
        .print-btn {
          display: none !important;
        }
      }
    </style>
  </head>

  <body>
    <!-- Abstract Code Symbols Background -->
    <div class="background-code-symbols">
      <div class="code-symbol">{</div>
      <div class="code-symbol">}</div>
      <div class="code-symbol">&lt;/&gt;</div>
      <div class="code-symbol">()</div>
      <div class="code-symbol">[]</div>
      <div class="code-symbol">=&gt;</div>
    </div>

    <!-- Abstract Background Blobs -->
    <div id="blob-1" class="abstract-blob blob-1"></div>
    <div id="blob-2" class="abstract-blob blob-2"></div>
    <div id="blob-3" class="abstract-blob blob-3"></div>
    <div id="blob-4" class="abstract-blob blob-4"></div>

    <!-- Dark Mode Toggle -->
    <button
      class="dark-mode-toggle"
      onclick="toggleDarkMode()"
      title="Toggle Dark Mode"
    >
      <i class="fas fa-moon" id="theme-icon"></i>
    </button>

    <!-- Resume Download Button -->
    <a
      href="/assets/downloads/resume.pdf"
      download
      class="print-btn"
      title="Download Resume PDF"
      onclick="if(typeof gtag!=='undefined')gtag('event','resume_download',{'location':'floating_button'});"
    >
      <i class="fas fa-download"></i>
      <span>Download Resume</span>
    </a>

    <div class="container">
      <header class="site-header" role="banner">
        <div class="site-brand">
          <span class="brand-mark" aria-hidden="true">AZ</span>
          <div class="brand-meta">
            <p class="brand-name">Abdul Aziz Zailani</p>
            <p class="brand-role">Senior DevOps Engineer Â· SRE</p>
          </div>
        </div>
        <button
          class="nav-toggle"
          type="button"
          aria-expanded="false"
          aria-controls="primary-nav"
        >
          <span class="nav-toggle-bar" aria-hidden="true"></span>
          <span class="nav-toggle-bar" aria-hidden="true"></span>
          <span class="nav-toggle-bar" aria-hidden="true"></span>
          <span class="nav-toggle-label">Menu</span>
        </button>
        <nav class="site-nav" id="primary-nav" aria-label="Primary navigation">git
          <a class="nav-link" href="#hero" data-nav="hero">
            <i class="fas fa-user"></i>
            <span>About</span>
          </a>
          <a class="nav-link" href="#experience" data-nav="experience">
            <i class="fas fa-briefcase"></i>
            <span>Experience</span>
          </a>
          <a class="nav-link" href="#skills" data-nav="skills">
            <i class="fas fa-code"></i>
            <span>Skills</span>
          </a>
          <a class="nav-link" href="#contact" data-nav="contact">
            <i class="fas fa-envelope"></i>
            <span>Contact</span>
          </a>
        </nav>
      </header>
      <main>
        <section>{{ content }}</section>
      </main>
    </div>

    <!-- Accordion JavaScript -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const accordions = document.querySelectorAll(".accordion-header");

        accordions.forEach(function (accordion) {
          accordion.addEventListener("click", function () {
            const content = this.nextElementSibling;
            const isExpanded = content.classList.contains("expanded");
            const sectionTitle =
              this.querySelector(".accordion-title span")?.textContent ||
              "Unknown";

            // Track accordion clicks
            if (typeof gtag !== "undefined") {
              gtag("event", "accordion_click", {
                section: sectionTitle,
                action: isExpanded ? "closed" : "opened",
              });
            }

            // Close all accordions in the same section
            const allContents = document.querySelectorAll(".accordion-content");
            const allHeaders = document.querySelectorAll(".accordion-header");

            allContents.forEach(function (item) {
              item.classList.remove("expanded");
            });
            allHeaders.forEach(function (header) {
              header.classList.remove("active");
            });

            // Open clicked accordion if it wasn't expanded
            if (!isExpanded) {
              content.classList.add("expanded");
              this.classList.add("active");
            }
          });
        });

        // Track print button clicks
        const printBtn = document.querySelector(".print-btn");
        if (printBtn) {
          printBtn.addEventListener("click", function () {
            if (typeof gtag !== "undefined") {
              gtag("event", "print_button_click", {
                page_title: "{{ page.title }}",
              });
            }
          });
        }

        // Track outbound links
        document.querySelectorAll('a[href^="http"]').forEach(function (link) {
          link.addEventListener("click", function (e) {
            if (typeof gtag !== "undefined") {
              gtag("event", "outbound_link_click", {
                link_url: this.href,
                link_text: this.textContent || this.innerText,
              });
            }
          });
        });

        // Track time on page
        let timeOnPage = Date.now();
        window.addEventListener("beforeunload", function () {
          const duration = Math.round((Date.now() - timeOnPage) / 1000);
          if (typeof gtag !== "undefined") {
            gtag("event", "page_exit", {
              duration: duration,
            });
          }
        });
      });

      // Dark Mode Toggle
      function toggleDarkMode() {
        const body = document.body;
        const icon = document.getElementById("theme-icon");

        body.classList.toggle("dark-mode");

        if (body.classList.contains("dark-mode")) {
          icon.classList.remove("fa-moon");
          icon.classList.add("fa-sun");
          localStorage.setItem("darkMode", "enabled");

          // Update blob colors for dark mode
          updateBlobColors("dark");
        } else {
          icon.classList.remove("fa-sun");
          icon.classList.add("fa-moon");
          localStorage.setItem("darkMode", "disabled");

          // Reset blob colors
          updateBlobColors("light");
        }
      }

      // Update abstract blob colors
      function updateBlobColors(mode) {
        const blob1 = document.getElementById("blob-1");
        const blob2 = document.getElementById("blob-2");
        const blob3 = document.getElementById("blob-3");
        const blob4 = document.getElementById("blob-4");

        if (mode === "dark") {
          if (blob1)
            blob1.style.background =
              "radial-gradient(circle, rgba(255, 215, 0, 0.4), rgba(255, 140, 0, 0.2), transparent 70%)";
          if (blob2)
            blob2.style.background =
              "radial-gradient(circle, rgba(255, 215, 0, 0.4), rgba(255, 140, 0, 0.2), transparent 70%)";
          if (blob3)
            blob3.style.background =
              "radial-gradient(circle, rgba(255, 215, 0, 0.35), rgba(255, 140, 0, 0.15), transparent 70%)";
          if (blob4)
            blob4.style.background =
              "linear-gradient(135deg, rgba(255, 215, 0, 0.35), rgba(255, 140, 0, 0.25), rgba(255, 215, 0, 0.2))";
        } else {
          if (blob1)
            blob1.style.background =
              "radial-gradient(circle, rgba(102, 126, 234, 0.6), rgba(102, 126, 234, 0.3), transparent 70%)";
          if (blob2)
            blob2.style.background =
              "radial-gradient(circle, rgba(118, 75, 162, 0.6), rgba(118, 75, 162, 0.3), transparent 70%)";
          if (blob3)
            blob3.style.background =
              "radial-gradient(circle, rgba(102, 126, 234, 0.5), rgba(102, 126, 234, 0.2), transparent 70%)";
          if (blob4)
            blob4.style.background =
              "linear-gradient(135deg, rgba(118, 75, 162, 0.5), rgba(102, 126, 234, 0.4), rgba(118, 75, 162, 0.3))";
        }
      }

      // Apply saved dark mode preference
      document.addEventListener("DOMContentLoaded", function () {
        const savedMode = localStorage.getItem("darkMode");
        const body = document.body;
        const icon = document.getElementById("theme-icon");

        const header = document.querySelector(".site-header");
        const navToggle = document.querySelector(".nav-toggle");

        if (savedMode === "enabled") {
          body.classList.add("dark-mode");
          icon.classList.remove("fa-moon");
          icon.classList.add("fa-sun");
        }

        const navLinks = Array.from(document.querySelectorAll(".nav-link"));
        const sections = navLinks
          .map((link) => {
            const targetId = link.getAttribute("href")?.replace("#", "");
            return document.getElementById(targetId);
          })
          .filter(Boolean);

        function setActiveLink(id) {
          navLinks.forEach((link) => {
            const isActive = link.getAttribute("href") === `#${id}`;
            link.classList.toggle("nav-link--active", isActive);
            if (isActive) {
              link.setAttribute("aria-current", "page");
            } else {
              link.removeAttribute("aria-current");
            }
          });
        }

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                setActiveLink(entry.target.id);
              }
            });
          },
          {
            rootMargin: "-55% 0px -40% 0px",
            threshold: 0.1,
          }
        );

        sections.forEach((section) => observer.observe(section));

        if (sections[0]) {
          setActiveLink(sections[0].id);
        }

        function closeNavMenu() {
          document.body.classList.remove("nav-open");
          if (navToggle) {
            navToggle.setAttribute("aria-expanded", "false");
          }
          header?.classList.remove("site-header--open");
        }

        function scrollToSection(id) {
          const element = document.getElementById(id);
          if (!element) return;

          const prefersReducedMotion = window.matchMedia(
            "(prefers-reduced-motion: reduce)"
          ).matches;

          element.scrollIntoView({
            behavior: prefersReducedMotion ? "auto" : "smooth",
            block: "start",
          });

          if (typeof history !== "undefined" && history.pushState) {
            history.pushState(null, "", `#${id}`);
          }

          if (typeof gtag !== "undefined") {
            gtag("event", "navigation_click", {
              section: id,
            });
          }

          closeNavMenu();
        }

        navLinks.forEach((link) => {
          link.addEventListener("click", (event) => {
            event.preventDefault();
            const targetId = link.getAttribute("href")?.replace("#", "");
            if (targetId) {
              scrollToSection(targetId);
            }
          });
        });

        if (navToggle && header) {
          navToggle.addEventListener("click", () => {
            const isExpanded =
              navToggle.getAttribute("aria-expanded") === "true";
            navToggle.setAttribute("aria-expanded", String(!isExpanded));
            document.body.classList.toggle("nav-open", !isExpanded);
            header.classList.toggle("site-header--open", !isExpanded);
          });
        }

        window.addEventListener("resize", () => {
          if (window.innerWidth > 960) {
            closeNavMenu();
            header?.classList.remove("site-header--open");
          }
        });
      });
    </script>
  </body>
</html>
